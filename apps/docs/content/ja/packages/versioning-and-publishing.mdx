import { Callout } from "nextra/components";
import LocalizedLink from "../../../components/LocalizedLink";

# ğŸ¦‹ ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã¨å…¬é–‹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [Changesets](https://github.com/changesets/changesets) ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨å…¬é–‹ã‚’ç°¡ç´ åŒ–ã—ã¦ã„ã¾ã™ã€‚
Changesets ã¯ãƒ¢ãƒãƒ¬ãƒç’°å¢ƒã§ç‰¹ã«æœ‰ç”¨ã§ã€å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å¤‰æ›´ã‚’è¿½è·¡ã—ã€ãã‚Œã«åŸºã¥ã„ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ `pnpm` ã¨ `Changesets` ã‚’ä½¿ã£ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã©ã®ã‚ˆã†ã«ç®¡ç†ã—ã€å…¬é–‹ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã‚‹ã‹ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ› ï¸ äº‹å‰æº–å‚™

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ `Changesets` ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã„ãã¤ã‹ã®äº‹å‰æº–å‚™ãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚

### å¿…é ˆ

- <LocalizedLink href="/setup/github-apps/changeset-bot">`è¨­å®š > GitHub Apps > changeset-bot`</LocalizedLink> ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ Changesets ãƒœãƒƒãƒˆã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
- <LocalizedLink href="/setup/github-actions/gh-actions-permission">`è¨­å®š > GitHub Actions > ãƒªãƒã‚¸ãƒˆãƒªæ¨©é™è¨­å®š`</LocalizedLink> ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ GitHub Actions ã®æ¨©é™ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

### ä»»æ„

- <LocalizedLink href="/setup/npm">`è¨­å®š > NPM`</LocalizedLink> ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ NPM ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ npm å…¬é–‹ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚

## ğŸ”„ ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã¨å…¬é–‹ãƒ—ãƒ­ã‚»ã‚¹

<Callout type="info">
  changeset ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã¨å…¬é–‹ãƒ—ãƒ­ã‚»ã‚¹ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/changesets/changesets) ã‚’ã”å‚ç…§ãã ã•ã„ã€‚
</Callout>

### (1) âœï¸ æ–°ã—ã„å¤‰æ›´ã®è¿½åŠ 

ãƒ­ãƒ¼ã‚«ãƒ«ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å¤‰æ›´å†…å®¹ã‚’è¨˜è¿°ã§ãã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```bash
pnpm changeset
```

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¾“ã£ã¦å¤‰æ›´å†…å®¹ã‚’è¨˜è¿°ã™ã‚‹ã¨ã€

![CLI prompt](/assets/images/packages/versioning-and-publishing/img-1.png)

Changesets ã¯æ–°ã—ã„ changeset ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãã‚Œã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã€‚

|ã‚³ãƒŸãƒƒãƒˆ|changeset|
|-|-|
|![CLI-created-commit](/assets/images/packages/versioning-and-publishing/img-2.png)|![CLI-created-changeset](/assets/images/packages/versioning-and-publishing/img-2-1.png)|

### (2) ğŸ¦‹ æ–°ã—ã„ changeset ã‚³ãƒŸãƒƒãƒˆã‚’å«ã‚€ PR ã®ä½œæˆ

#### 1) æ–°ã—ã„ changeset PR ã®ä½œæˆ

å…ˆã»ã©ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œæˆã—ãŸæ–°ã—ã„ changeset è¿½åŠ ã‚³ãƒŸãƒƒãƒˆã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ PR ã‚’ä½œæˆã—ã¾ã™ã€‚
ã™ã‚‹ã¨ã€changeset-bot ãŒ PR ã«å«ã¾ã‚Œã‚‹æ–°ã—ã„ changeset ã‚³ãƒŸãƒƒãƒˆã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã—ã€
PR ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ¡ãƒ³ãƒˆã§å¤‰æ›´å†…å®¹ã‚’è¦ç´„ã—ã¾ã™ã€‚

![changeset-bot-reply-to-pr](/assets/images/packages/versioning-and-publishing/img-3.png)

<Callout type="info">
  **changeset ã‚³ãƒŸãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆ** \
  changeset-bot ã¯ changeset ã‚³ãƒŸãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’çŸ¥ã‚‰ã›ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã—ã¾ã™ã€‚ \
  ![changeset-bot-reply-to-pr-2](/assets/images/packages/versioning-and-publishing/img-3-1.png)
</Callout>

#### 2) æ–°ã—ã„ changeset PR ã®æ‰¿èª

æ–°ã—ã„ changeset ã‚’å«ã‚€ PR ã‚’æ‰¿èªã™ã‚‹ã¨ã€changeset-bot ãŒ `release` ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
pnpm changeset version
```

![commits-in-pr](/assets/images/packages/versioning-and-publishing/img-4.png)

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€PR ã«å«ã¾ã‚Œã‚‹å¤‰æ›´å†…å®¹ã«åŸºã¥ã„ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ`package.json` ãƒ•ã‚¡ã‚¤ãƒ«ã® `version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã‚’æ›´æ–°ã—ã€`CHANGELOG.md` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã™ã‚‹åˆ¥ã®ã‚³ãƒŸãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

![commits-in-pr](/assets/images/packages/versioning-and-publishing/img-5.png)

#### 3) æ–°ã—ã„ changeset åæ˜  PR ã®ä½œæˆ

changeset-bot ã¯ã“ã®ã‚³ãƒŸãƒƒãƒˆã‚’ã™ãã« main ãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸ã™ã‚‹ã®ã§ã¯ãªãã€æ–°ã—ã„ PR ã‚’ä½œæˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰æ›´å†…å®¹ã‚’ç¢ºèªã—ã¦æ‰‹å‹•ã§æ‰¿èªã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

![changeset-bot-create-pr](/assets/images/packages/versioning-and-publishing/img-6.png)

ä»¥ä¸‹ã¯ changeset-bot ãŒä½œæˆã—ãŸ PR ã®ä¾‹ã§ã™ã€‚

![pr-created-by-changeset-bot](/assets/images/packages/versioning-and-publishing/img-7.png)

### (3) ğŸ¦‹ æ–°ã—ã„ changeset åæ˜  PR ã®æ‰¿èª

å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ changeset-bot ãŒä½œæˆã—ãŸ PR ã‚’æ‰¿èªã™ã‚‹ã¨ã€`release` ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

```bash
pnpm changeset publish
```

![release-workflow-log](/assets/images/packages/versioning-and-publishing/img-8.png)

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯æ¬¡ã®ä½œæ¥­ã‚’è¡Œã„ã¾ã™ï¼š

#### 1) ğŸ“ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã”ã¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã¨æ›´æ–°ãƒãƒ¼ãƒˆä½œæˆ

- `package.json` ã® `version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ›´æ–°ã•ã‚Œã€
- `CHANGELOG.md` ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚

![file-changes-by-changesets-versioning](/assets/images/packages/versioning-and-publishing/img-9.png)

#### 2) ğŸ· ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã®ä½œæˆ

PR ãŒæ‰¿èªã•ã‚Œã‚‹ã¨ã€GitHub Actions ãŒè‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã€å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

![created-release-tag](/assets/images/packages/versioning-and-publishing/img-10.png)

#### 3) ğŸš€ npm ã¸ã®å…¬é–‹

æ›´æ–°ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ npm ã«å…¬é–‹ã—ã¾ã™ã€‚\
å…¬é–‹ã«ã¯ `NPM_TOKEN` ãŒ GitHub Secrets ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

![published-npm-packages](/assets/images/packages/versioning-and-publishing/img-11.png)
